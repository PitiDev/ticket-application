    <!-- Create Ticket Modal -->
    <TransitionRoot appear :show="showCreateModal" as="template">
      <Dialog as="div" class="relative z-10" @close="showCreateModal = false">
        <TransitionChild
          enter="ease-out duration-300"
          enter-from="opacity-0"
          enter-to="opacity-100"
          leave="ease-in duration-200"
          leave-from="opacity-100"
          leave-to="opacity-0"
        >
          <div class="fixed inset-0 bg-gray-900/25 backdrop-blur-sm" />
        </TransitionChild>

        <div class="fixed inset-0 overflow-y-auto">
          <div class="flex min-h-full items-center justify-center p-4 text-center">
            <TransitionChild
              enter="ease-out duration-300"
              enter-from="opacity-0 scale-95"
              enter-to="opacity-100 scale-100"
              leave="ease-in duration-200"
              leave-from="opacity-100 scale-100"
              leave-to="opacity-0 scale-95"
            >
              <!-- Enhanced DialogPanel with complete ticket fields -->
              <DialogPanel
                class="w-full max-w-7xl transform overflow-hidden rounded-2xl bg-white p-10 text-left align-middle shadow-xl transition-all mx-4"
              >
                <DialogTitle as="div" class="flex items-center justify-between mb-8">
                  <div>
                    <h3 class="text-3xl font-semibold text-gray-900">
                      Create New Ticket
                    </h3>
                    <p class="mt-2 text-lg text-gray-500">
                      Fill in the details for your support request
                    </p>
                  </div>
                  <button
                    @click="showCreateModal = false"
                    class="text-gray-400 hover:text-gray-500 focus:outline-none"
                  >
                    <XMarkIcon class="h-8 w-8" />
                  </button>
                </DialogTitle>

                <form @submit.prevent="handleSubmit" class="space-y-8">
                  <div class="grid grid-cols-3 gap-8">
                    <!-- Left Column - Title & Description -->
                    <div class="col-span-2 space-y-8">
                      <!-- Title -->
                      <div>
                        <label
                          for="title"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Title</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <input
                            type="text"
                            id="title"
                            v-model="newTicket.title"
                            required
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                            placeholder="Brief description of the issue"
                          />
                        </div>
                      </div>

                      <!-- Description -->
                      <div>
                        <label
                          for="description"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Description</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <textarea
                            id="description"
                            v-model="newTicket.description"
                            rows="12"
                            required
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200 resize-none"
                            placeholder="Detailed explanation of your issue"
                          ></textarea>
                        </div>
                      </div>

                      <!-- File Upload Section -->
                      <div class="mt-6">
                        <label class="block text-lg font-medium text-gray-700 mb-3">
                          Attachments
                        </label>

                        <!-- Drag & Drop Zone -->
                        <div
                          @dragover.prevent="dragOver = true"
                          @dragleave.prevent="dragOver = false"
                          @drop.prevent="handleDrop"
                          :class="[
                            'mt-2 flex justify-center rounded-lg border-2 border-dashed px-6 py-10',
                            dragOver
                              ? 'border-indigo-500 bg-indigo-50'
                              : 'border-gray-300 hover:border-indigo-400',
                          ]"
                        >
                          <div class="text-center">
                            <PaperClipIcon class="mx-auto h-12 w-12 text-gray-400" />
                            <div class="mt-4 flex text-sm leading-6 text-gray-600">
                              <label
                                for="file-upload"
                                class="relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"
                              >
                                <span>Upload files</span>
                                <input
                                  id="file-upload"
                                  type="file"
                                  multiple
                                  class="sr-only"
                                  @change="handleFileSelect"
                                />
                              </label>
                              <p class="pl-1">or drag and drop</p>
                            </div>
                            <p class="text-xs leading-5 text-gray-600">
                              Up to 10MB per file
                            </p>
                          </div>
                        </div>

                        <!-- File List -->
                        <div v-if="selectedFiles.length > 0" class="mt-4">
                          <div
                            v-for="file in selectedFiles"
                            :key="file.id"
                            class="flex items-center justify-between py-3 pl-3 pr-4 text-sm border rounded-lg mb-2"
                          >
                            <div class="flex items-center flex-1 w-0">
                              <PaperClipIcon
                                class="h-5 w-5 flex-shrink-0 text-gray-400"
                              />
                              <div class="ml-4 flex min-w-0 flex-1 gap-2">
                                <span class="truncate font-medium">{{ file.name }}</span>
                                <span class="flex-shrink-0 text-gray-400">{{
                                  file.size
                                }}</span>
                              </div>
                            </div>
                            <div class="ml-4 flex-shrink-0">
                              <button
                                @click="removeFile(file.id)"
                                class="font-medium text-red-600 hover:text-red-500"
                              >
                                Remove
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Due Date and Privacy Settings -->
                      <div class="grid grid-cols-2 gap-6">
                        <!-- Due Date -->
                        <div>
                          <label
                            for="dueDate"
                            class="block text-lg font-medium text-gray-700 mb-3"
                            >Due Date</label
                          >
                          <div class="relative rounded-lg shadow-sm">
                            <input
                              type="datetime-local"
                              id="dueDate"
                              v-model="newTicket.due_date"
                              class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                            />
                          </div>
                        </div>

                        <!-- Privacy Toggle -->
                        <div class="flex items-center mt-8">
                          <div class="relative rounded-lg shadow-sm">
                            <label class="inline-flex items-center cursor-pointer">
                              <input
                                type="checkbox"
                                v-model="newTicket.is_private"
                                class="sr-only peer"
                              />
                              <div
                                class="relative w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-600"
                              ></div>
                              <span class="ml-3 text-lg font-medium text-gray-700"
                                >Private Ticket</span
                              >
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Parent Ticket Reference -->
                      <div>
                        <label
                          for="parentTicket"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Parent Ticket (Optional)</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <select
                            id="parentTicket"
                            v-model="newTicket.parent_ticket_id"
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                          >
                            <option value="">No parent ticket</option>
                            <option
                              v-for="ticket in existingTickets"
                              :key="ticket.id"
                              :value="ticket.id"
                            >
                              {{ ticket.ticket_number }} - {{ ticket.title }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-8">
                      <!-- Priority Selection -->
                      <div>
                        <label class="block text-lg font-medium text-gray-700 mb-4"
                          >Priority Level</label
                        >
                        <div class="space-y-4">
                          <button
                            type="button"
                            @click="newTicket.priority_id = priority.id"
                            v-for="priority in priorities"
                            :key="priority.id"
                            :class="[
                              'relative flex items-center w-full p-6 rounded-xl border-2 transition-all duration-200',
                              newTicket.priority_id === priority.id
                                ? 'border-indigo-600 bg-indigo-50'
                                : 'border-gray-300 hover:border-indigo-300 hover:bg-gray-50',
                            ]"
                          >
                            <!-- Priority Icon -->
                            <div
                              class="w-16 h-16 rounded-full flex items-center justify-center"
                              :class="{
                                'bg-red-100': priority.name === 'High',
                                'bg-yellow-100': priority.name === 'Medium',
                                'bg-gray-100': priority.name === 'Low',
                              }"
                            >
                              <ExclamationCircleIcon
                                v-if="priority.name === 'High'"
                                class="h-10 w-10 text-red-600"
                              />
                              <ClockIcon
                                v-if="priority.name === 'Medium'"
                                class="h-10 w-10 text-yellow-600"
                              />
                              <InboxIcon
                                v-if="priority.name === 'Low'"
                                class="h-10 w-10 text-gray-600"
                              />
                            </div>

                            <!-- Priority Details -->
                            <div class="ml-4 flex-1">
                              <span
                                class="block text-xl font-medium"
                                :class="{
                                  'text-red-700': priority.name === 'High',
                                  'text-yellow-700': priority.name === 'Medium',
                                  'text-gray-700': priority.name === 'Low',
                                }"
                              >
                                {{ priority.name }}
                              </span>
                              <span class="text-base text-gray-500 mt-1 block">
                                {{ priority.description }}
                              </span>
                            </div>

                            <div
                              v-if="newTicket.priority_id === priority.id"
                              class="absolute -top-2 -right-2 bg-indigo-600 rounded-full p-1.5"
                            >
                              <CheckCircleIcon class="h-6 w-6 text-white" />
                            </div>
                          </button>
                        </div>
                      </div>

                      <!-- Category -->
                      <div>
                        <label
                          for="category"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Category</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <select
                            id="category"
                            v-model="newTicket.category_id"
                            required
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                          >
                            <option value="">Select a category</option>
                            <option
                              v-for="category in categories"
                              :key="category.id"
                              :value="category.id"
                            >
                              {{ category.name }}
                            </option>
                          </select>
                        </div>
                      </div>

                      <!-- Department -->
                      <div>
                        <label
                          for="department"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Department</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <select
                            id="department"
                            v-model="newTicket.department_id"
                            required
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                          >
                            <option value="">Select department</option>
                            <option
                              v-for="department in departments"
                              :key="department.id"
                              :value="department.id"
                            >
                              {{ department.name }}
                            </option>
                          </select>
                        </div>
                      </div>

                      <!-- Assigned To -->
                      <div>
                        <label
                          for="assignedTo"
                          class="block text-lg font-medium text-gray-700 mb-3"
                          >Assign To (Optional)</label
                        >
                        <div class="relative rounded-lg shadow-sm">
                          <select
                            id="assignedTo"
                            v-model="newTicket.assigned_to"
                            class="block w-full rounded-lg border-2 border-gray-300 px-4 py-3 text-base focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 hover:border-gray-400 transition-colors duration-200"
                          >
                            <option value="">Select assignee</option>
                            <option v-for="user in users" :key="user.id" :value="user.id">
                              {{ user.full_name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Form Actions -->
                  <div class="mt-10 flex justify-end space-x-4">
                    <button
                      type="button"
                      @click="showCreateModal = false"
                      class="inline-flex justify-center rounded-lg border-2 border-gray-300 bg-white px-8 py-4 text-lg font-medium text-gray-700 shadow-sm hover:bg-gray-50 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      :disabled="loading"
                      class="inline-flex justify-center rounded-lg border-2 border-transparent bg-indigo-600 px-8 py-4 text-lg font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <template v-if="loading">
                        <svg
                          class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                        >
                          <circle
                            class="opacity-25"
                            cx="12"
                            cy="12"
                            r="10"
                            stroke="currentColor"
                            stroke-width="4"
                          ></circle>
                          <path
                            class="opacity-75"
                            fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                          ></path>
                        </svg>
                        Creating...
                      </template>
                      <template v-else> Create Ticket </template>
                    </button>
                  </div>
                </form>
              </DialogPanel>
            </TransitionChild>
          </div>
        </div>
      </Dialog>
    </TransitionRoot>